import { DocsLayoutClient } from "@/lib/docs-layout-client";
import { baseOptions } from "@/lib/layout.shared";
import { buildAliasTree } from "@/lib/page-tree";
import { getServiceVersionOptions } from "@/lib/service-version-options";
import { ServiceVersionSwitcher } from "@/lib/service-version-switcher";
import { getSource } from "@/lib/source";
import { RootProvider } from "fumadocs-ui/provider/next";
import type { Metadata } from "next";
import { Noto_Sans } from "next/font/google";
import "./globals.css";

const fontSans = Noto_Sans({ variable: "--font-sans" });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default async function RootLayout({ children }: LayoutProps<"/">) {
  const [source, serviceVersionOptions] = await Promise.all([
    getSource(),
    getServiceVersionOptions(),
  ]);
  const tree = source.getPageTree();
  const aliasTree = await buildAliasTree(tree);
  const navChildren = (
    <ServiceVersionSwitcher
      services={serviceVersionOptions.services}
      versionsByService={serviceVersionOptions.versionsByService}
    />
  );

  return (
    <html lang="en" className={fontSans.variable} suppressHydrationWarning>
      <body className="flex min-h-screen flex-col font-sans antialiased">
        <RootProvider>
          <DocsLayoutClient
            tree={tree}
            aliasTree={aliasTree}
            {...baseOptions({ navChildren })}
          >
            {children}
          </DocsLayoutClient>
        </RootProvider>
      </body>
    </html>
  );
}
